<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: create-server.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: create-server.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>module.exports = createServer

// requires
var Sequelize  = require('sequelize')
var express    = require('express')
var bodyParser = require('body-parser')
var https      = require('https')
var fs         = require('fs')

var wc         = require('../')
var createApp  = require('./create-app')


/**
* server function
* @param  {Object} config [description]
*/
function createServer(argv) {
  // vars
  var sequelize

  var config = wc.getConfig()

  var defaultCurrency = 'https://w3id.org/cc#bit'
  var defaultDatabase = 'webcredits'
  var defaultWallet   = 'https://localhost/wallet/test#this'

  config.currency = argv.currency || config.currency || defaultCurrency
  config.database = argv.database || config.database || defaultDatabase
  config.wallet   = argv.wallet   || config.wallet   || defaultWallet
  config.key      = argv.key      || null
  config.cert     = argv.cert     || null

  var port = argv.port

  // run main
  sequelize = wc.setupDB(config)

  var app = express()
  wcApp = createApp(null, sequelize, config)
  app.use('/', wcApp)

  var defaultPort = 11077
  port = port || defaultPort

  console.log(config)

  var key
  try {
    key = fs.readFileSync(config.key)
  } catch (e) {
    throw new Error('Can\'t find SSL key in ' + config.key)
  }

  var cert
  try {
    cert = fs.readFileSync(config.cert)
  } catch (e) {
    throw new Error('Can\'t find SSL cert in ' + config.cert)
  }

  var credentials = {
    key: key,
    cert: cert,
    requestCert: true
  }

  server = https.createServer(credentials, app)

  return server

}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#balance">balance</a></li><li><a href="global.html#createDB">createDB</a></li><li><a href="global.html#createServer">createServer</a></li><li><a href="global.html#createTables">createTables</a></li><li><a href="global.html#deposit">deposit</a></li><li><a href="global.html#genesis">genesis</a></li><li><a href="global.html#genesisInit">genesisInit</a></li><li><a href="global.html#getBalance">getBalance</a></li><li><a href="global.html#getConfig">getConfig</a></li><li><a href="global.html#getCredit">getCredit</a></li><li><a href="global.html#getDeposit">getDeposit</a></li><li><a href="global.html#getReputation">getReputation</a></li><li><a href="global.html#getSpent">getSpent</a></li><li><a href="global.html#insert">insert</a></li><li><a href="global.html#reputation">reputation</a></li><li><a href="global.html#setupDB">setupDB</a></li><li><a href="global.html#today">today</a></li><li><a href="global.html#toledger">toledger</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Wed Jun 22 2016 17:04:43 GMT+0200 (CEST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
